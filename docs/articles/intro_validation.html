<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>Introduction to the validation functions • factcuratoR</title>
<script src="../lightswitch.js"></script><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet">
<script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.4.2/css/all.min.css" rel="stylesheet">
<link href="../deps/font-awesome-6.4.2/css/v4-shims.min.css" rel="stylesheet">
<script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Introduction to the validation functions">
</head>
<body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top " aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">factcuratoR</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">1.2.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto">
<li class="nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="active nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-articles" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true">Articles</button>
  <ul class="dropdown-menu" aria-labelledby="dropdown-articles">
<li><a class="dropdown-item" href="../articles/example_cultivar_matching.html">Example of the cultivar matching process</a></li>
    <li><a class="dropdown-item" href="../articles/intro_codebooks.html">Introduction to the codebook structure</a></li>
    <li><a class="dropdown-item" href="../articles/intro_validation.html">Introduction to the validation functions</a></li>
  </ul>
</li>
      </ul>
<ul class="navbar-nav">
<li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json">
</form></li>
<li class="nav-item"><a class="external-link nav-link" href="https://github.com/IdahoAgStats/factcuratoR/" aria-label="GitHub"><span class="fa fab fa-github fa-lg"></span></a></li>
<li class="nav-item dropdown">
  <button class="nav-link dropdown-toggle" type="button" id="dropdown-lightswitch" data-bs-toggle="dropdown" aria-expanded="false" aria-haspopup="true" aria-label="Light switch"><span class="fa fa-sun"></span></button>
  <ul class="dropdown-menu dropdown-menu-end" aria-labelledby="dropdown-lightswitch">
<li><button class="dropdown-item" data-bs-theme-value="light"><span class="fa fa-sun"></span> Light</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="dark"><span class="fa fa-moon"></span> Dark</button></li>
    <li><button class="dropdown-item" data-bs-theme-value="auto"><span class="fa fa-adjust"></span> Auto</button></li>
  </ul>
</li>
      </ul>
</div>


  </div>
</nav><div class="container template-article">




<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Introduction to the validation functions</h1>
                        <h4 data-toc-skip class="author">Jacqueline
Tay</h4>
            
            <h4 data-toc-skip class="date">Nov 12, 2024</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/IdahoAgStats/factcuratoR/blob/HEAD/vignettes/intro_validation.Rmd" class="external-link"><code>vignettes/intro_validation.Rmd</code></a></small>
      <div class="d-none name"><code>intro_validation.Rmd</code></div>
    </div>

    
    
<div class="section level2">
<h2 id="introduction">Introduction<a class="anchor" aria-label="anchor" href="#introduction"></a>
</h2>
<p>The purpose of <strong>factcuratoR</strong> is to provide sets of
functions to help standardize variety testing data for curation of
variety testing data sets supporting the WAVE project.</p>
<p>The goal of the WAVE program curation is to generate <u>trial
data</u> <em>and</em> <u>trial metadata</u> that conform to the
controlled vocabulary codebooks.</p>
<p>The codebooks specify the variable required for each file (as a
single column in a data frame, matrix, tibble, etc) and the accepted
values for the the variable. See the <a href="https://idahoagstats.github.io/factcuratoR/articles/intro_codebooks.html">Introduction
to codebooks vignette</a> for more information on the structure of and
formatting for the codebooks.</p>
</div>
<div class="section level2">
<h2 id="overview-of-validation-functions">Overview of validation functions<a class="anchor" aria-label="anchor" href="#overview-of-validation-functions"></a>
</h2>
<p>The validation functions check that the data conforms to the
controlled vocabulary codebooks. There are functions to validate:</p>
<ul>
<li>variable names. The functions return tables for the curator to check
that required variables are present and that names are
standardized.</li>
<li>variable values. The functions return tables for the curator to
check that values for a single variable match controlled vocabularies or
are in the accepted value range.</li>
</ul>
<p>Finally, <a href="https://idahoagstats.github.io/factcuratoR/reference/standardize_cols_by_cb.html"><code>standardize_cols_by_cb()</code></a>
enables curators to standardize the files (select and order columns)
according to the standards established in the codebooks.</p>
<p>First, load <strong>factcuratoR</strong> and point to the main
codebook which must be named <em>codebooks_all_db.csv</em> for the
validation functions to find it.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">factcuratoR</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">rlang</span><span class="fu">::</span><span class="fu"><a href="https://rlang.r-lib.org/reference/is_installed.html" class="external-link">check_installed</a></span><span class="op">(</span><span class="st">"here"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">codebook_folder</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span></span>
<span>  <span class="st">"tests/testthat/test_controlled_vocab"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">knitroutputfolder</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://here.r-lib.org//reference/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"inst/extdata/intro_validation"</span>, <span class="st">"output"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="create-some-test-data">Create some test data<a class="anchor" aria-label="anchor" href="#create-some-test-data"></a>
</h2>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">test_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html" class="external-link">data.frame</a></span><span class="op">(</span>location <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Aberdeen"</span>, <span class="st">"Soda Springs"</span>, <span class="cn">NA</span>, <span class="st">"location_x"</span><span class="op">)</span>,</span>
<span>                        year <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/rep.html" class="external-link">rep</a></span><span class="op">(</span><span class="fl">2020</span>, <span class="fl">3</span><span class="op">)</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                        variety <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"variety_1"</span>, <span class="st">"AAC Wildfire"</span>, <span class="st">""</span>, <span class="cn">NA</span><span class="op">)</span>,</span>
<span>                        rep_temp <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">4</span>,</span>
<span>                        sourcefile <span class="op">=</span> <span class="st">"test"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="validate-trial-data">Validate trial data<a class="anchor" aria-label="anchor" href="#validate-trial-data"></a>
</h2>
<p>It may be easiest to point the most cleaned up version of the data to
a new variable (e.g. df_validate below) so that the calls to the
validation functions don’t need to be updated every time there is a more
cleaned up version of the data.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">df_validate</span> <span class="op">&lt;-</span> <span class="va">test_data</span></span></code></pre></div>
<div class="section level3">
<h3 id="check-column-names">Check column names<a class="anchor" aria-label="anchor" href="#check-column-names"></a>
</h3>
<p>The function <code>validate_colnames(</code>) will check the variable
names between the codebook and data. The argument
<code>codebook_name = "trial_data"</code> indicates what codebook from
the <em>codebooks_all_db.csv</em> should be used for this step.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colname_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/validate_colnames.html">validate_colnames</a></span><span class="op">(</span><span class="va">df_validate</span>, </span>
<span>                                   codebook_name <span class="op">=</span> <span class="st">"trial_data"</span>, </span>
<span>                                   db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span></span>
<span><span class="co">#&gt; Joining with `by = join_by(comment)`</span></span>
<span><span class="co">#&gt; Status: <span style="color: #949494;"># A tibble: 3 × 4</span> comment n required req <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #BCBCBC;">1</span></span></span>
<span><span class="co">#&gt; exists in both data and codebook 1 <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span> <span style="color: #BCBCBC;">2</span> not present in codebook: trial_data</span></span>
<span><span class="co">#&gt; 4 <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span> <span style="color: #BCBCBC;">3</span> not present in data 27 TRUE 6</span></span></code></pre></div>
<p>The main goal of validating column names is to get the value in the
required column of row 3 to be zero. A value of zero indicates that all
the required columns are present in the data and completely filled out.
The second row in the summary highlights columns that are not in the
codebook.</p>
<p>If required columns appear missing in the initial check, it may be
present in the data set with a differing name. Often this is the case
for many variables; collaborators each have their own unique name for
common variables. When this happens, creating a file to rename files en
masse is the best solution. See <a href="https://idahoagstats.github.io/facthelpeR/articles/intro_facthelper.html" class="external-link">facthelpeR</a>
for functions to help with renaming columns. Determining if a variable
is captured by the existing controlled vocabulary is a human decision
made based on your own knowledge and when needed, consultation with
other project participants. When in doubt, ask.</p>
<p>If a required variable is truly missing, then you will need to find
the data. Looking at annual reports is a good starting point, and you
may have to eventually request this information from the collaborator if
you cannot find it elsewhere.</p>
<p>Sometimes, there are also new variables not captured by the existing
vocabulary. In that case, we will need to decide if this variable should
be added to the database. The answer is usually “yes”, but usually a
discussion with project participants is needed for this decision. If
there is a decision to add a new variable, add it to controlled
vocabulary using the correct formatting described in the <a href="https://idahoagstats.github.io/factcuratoR/articles/intro_codebooks.html">Introduction
to codebooks vignette</a>.</p>
<div class="section level4">
<h4 id="full-report-of-validating-column-names">Full report of validating column names<a class="anchor" aria-label="anchor" href="#full-report-of-validating-column-names"></a>
</h4>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">colname_valid</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="15%">
<col width="23%">
<col width="10%">
<col width="9%">
<col width="41%">
</colgroup>
<thead><tr class="header">
<th align="left">colname_data</th>
<th align="left">colname_codebook</th>
<th align="left">required</th>
<th align="right">col_num</th>
<th align="left">comment</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">NA</td>
<td align="left">trial</td>
<td align="left">TRUE</td>
<td align="right">1</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">entry</td>
<td align="left">TRUE</td>
<td align="right">3</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">plot</td>
<td align="left">TRUE</td>
<td align="right">4</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">range</td>
<td align="left">TRUE</td>
<td align="right">6</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">rep</td>
<td align="left">TRUE</td>
<td align="right">5</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">row</td>
<td align="left">TRUE</td>
<td align="right">7</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">heading_date</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">yield_bu_acre</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">yield_lb_plot</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">yield_corrected</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">stand</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">moisture</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">height</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">falling_number</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">grain_protein</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">test_weight</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">test_weight_cleaned</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">lodging</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">plump_percent_6_64</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">thin_percent_5_64</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">yield_g_plot</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">yield_lb_acre</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">yield_kg_ha</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">hessian_fly_percent</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">emergence</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">fdk_rep_xx</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">inf_spikelet_rep_xx</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in data</td>
</tr>
<tr class="even">
<td align="left">location</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in codebook: trial_data</td>
</tr>
<tr class="odd">
<td align="left">year</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in codebook: trial_data</td>
</tr>
<tr class="even">
<td align="left">rep_temp</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in codebook: trial_data</td>
</tr>
<tr class="odd">
<td align="left">sourcefile</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
<td align="left">not present in codebook: trial_data</td>
</tr>
<tr class="even">
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">TRUE</td>
<td align="right">2</td>
<td align="left">exists in both data and codebook</td>
</tr>
</tbody>
</table>
</div>
<div class="section level4">
<h4 id="to-interact-with-the-variable-names-that-still-need-to-be-fixed">To interact with the variable names that still need to be fixed<a class="anchor" aria-label="anchor" href="#to-interact-with-the-variable-names-that-still-need-to-be-fixed"></a>
</h4>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colname_valid_check</span> <span class="op">&lt;-</span> <span class="va">colname_valid</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">comment</span> <span class="op">==</span> <span class="st">"not present in codebook: trial_data"</span><span class="op">)</span></span>
<span></span>
<span><span class="va">col_info</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/find_col_info.html">find_col_info</a></span><span class="op">(</span><span class="va">df_validate</span>, </span>
<span>                       cols_check <span class="op">=</span> <span class="va">colname_valid_check</span><span class="op">$</span><span class="va">colname_data</span>, </span>
<span>                       by_col <span class="op">=</span> <span class="va">sourcefile</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">col_info</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="right">n</th>
<th align="left">contained_in</th>
<th align="left">variable</th>
<th align="left">example</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="right">3</td>
<td align="left">test</td>
<td align="left">location</td>
<td align="left">Aberdeen</td>
</tr>
<tr class="even">
<td align="right">4</td>
<td align="left">test</td>
<td align="left">rep_temp</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="right">4</td>
<td align="left">test</td>
<td align="left">sourcefile</td>
<td align="left">test</td>
</tr>
<tr class="even">
<td align="right">3</td>
<td align="left">test</td>
<td align="left">year</td>
<td align="left">2020</td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="section level3">
<h3 id="check-column-contents">Check column contents<a class="anchor" aria-label="anchor" href="#check-column-contents"></a>
</h3>
<p>The function <code><a href="../reference/confront_data.html">confront_data()</a></code> is a wrapper around
<code><a href="https://rdrr.io/pkg/validate/man/confront.html" class="external-link">validate::confront()</a></code> that checks that column contents match
controlled vocabularies or are in the accepted value range.</p>
<p>Note: The argument <code>blends</code> = TRUE will check for blends
in the variety column</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colcontent_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/confront_data.html">confront_data</a></span><span class="op">(</span><span class="va">df_validate</span>, </span>
<span>                                  df_type <span class="op">=</span> <span class="st">"trial_data"</span>,</span>
<span>                                  db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some issues left to resolve </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   required fails   nNA error warning</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> TRUE         1     1     6       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> <span style="color: #BB0000;">NA</span>           0     0    21       0</span></span></code></pre></div>
<p>The summary output for validating column contents reports the number
of columns that have fails (that is, a column does not match controlled
vocabularies or is not within the accepted range) and NA values. A
column will return <code>error = TRUE</code> if a column is not present
in the data.</p>
<p>The goal of validating column contents is to achieve zero fails for
all columns and for required columns, achieve zero NA values (so that
each observation has a value).</p>
<p>The errors can be fixed by either fixing errors or standardizing
contents in the raw data or adding new controlled vocabularies to the
codebooks. For example, if the name “variety_1” is a real variety name,
then it should be added to the cultivar codebook.</p>
</div>
<div class="section level3">
<h3 id="full-report-of-validating-column-contents">Full report of validating column contents<a class="anchor" aria-label="anchor" href="#full-report-of-validating-column-contents"></a>
</h3>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">colcontent_summary</span> <span class="op">&lt;-</span> <span class="va">colcontent_valid</span><span class="op">[[</span><span class="st">"summary"</span><span class="op">]</span><span class="op">]</span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">colcontent_summary</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="12%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="4%">
<col width="53%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">required</th>
<th align="left">name</th>
<th align="right">items</th>
<th align="right">passes</th>
<th align="right">fails</th>
<th align="right">nNA</th>
<th align="left">error</th>
<th align="left">warning</th>
<th align="left">expression</th>
<th align="left">crop_type</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">variety</td>
<td align="right">4</td>
<td align="right">1</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">variety %vin% db[[“cultivar.csv”]][[“variety”]]</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">trial</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">is.character(trial)</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">entry</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">entry - 0 &gt;= -1e-08 &amp; entry - 500 &lt;= 1e-08
&amp; entry%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">plot</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">plot - 1 &gt;= -1e-08 &amp; plot - 1e+06 &lt;= 1e-08
&amp; plot%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">range</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">range - 1 &gt;= -1e-08 &amp; range - 200 &lt;= 1e-08
&amp; range%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">rep</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">rep - 1 &gt;= -1e-08 &amp; rep - 20 &lt;= 1e-08 &amp;
rep%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">row</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">row - 1 &gt;= -1e-08 &amp; row - 200 &lt;= 1e-08 &amp;
row%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">heading_date</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">heading_date - 1 &gt;= -1e-08 &amp; heading_date - 300
&lt;= 1e-08 &amp; heading_date%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">yield_bu_acre</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">yield_bu_acre - 0 &gt;= -1e-08 &amp; yield_bu_acre -
500 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">yield_lb_plot</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">yield_lb_plot - 0 &gt;= -1e-08 &amp; yield_lb_plot - 50
&lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">yield_corrected</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">yield_corrected - 0 &gt;= -1e-08 &amp; yield_corrected
- 500 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">stand</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">stand - 0 &gt;= -1e-08 &amp; stand - 100 &lt;=
1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">moisture</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">moisture - 0 &gt;= -1e-08 &amp; moisture - 30 &lt;=
1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">height</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">height - 0 &gt;= -1e-08 &amp; height - 200 &lt;=
1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">falling_number</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">falling_number - 0 &gt;= -1e-08 &amp; falling_number -
600 &lt;= 1e-08 &amp; falling_number%%1 == 0</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">grain_protein</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">grain_protein - 0 &gt;= -1e-08 &amp; grain_protein -
100 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">test_weight</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">test_weight - 0 &gt;= -1e-08 &amp; test_weight - 100
&lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">test_weight_cleaned</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">test_weight_cleaned - 0 &gt;= -1e-08 &amp;
test_weight_cleaned - 100 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">lodging</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">lodging - 0 &gt;= -1e-08 &amp; lodging - 100 &lt;=
1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">plump_percent_6_64</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">plump_percent_6_64 - 0 &gt;= -1e-08 &amp;
plump_percent_6_64 - 100 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">thin_percent_5_64</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">thin_percent_5_64 - 0 &gt;= -1e-08 &amp;
thin_percent_5_64 - 100 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">yield_g_plot</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">is.numeric(yield_g_plot)</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">yield_lb_acre</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">is.numeric(yield_lb_acre)</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">yield_kg_ha</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">is.numeric(yield_kg_ha)</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">hessian_fly_percent</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">hessian_fly_percent - 0 &gt;= -1e-08 &amp;
hessian_fly_percent - 100 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">emergence</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">emergence - 0 &gt;= -1e-08 &amp; emergence - 100 &lt;=
1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">NA</td>
<td align="left">fdk_rep_xx</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">fdk_rep_xx - 0 &gt;= -1e-08 &amp; fdk_rep_xx - 100
&lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">NA</td>
<td align="left">inf_spikelet_rep_xx</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">inf_spikelet_rep_xx - 0 &gt;= -1e-08 &amp;
inf_spikelet_rep_xx - 100 &lt;= 1e-08</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
<div class="section level4">
<h4 id="to-check-for-validation-fails-interactively">To check for validation fails interactively<a class="anchor" aria-label="anchor" href="#to-check-for-validation-fails-interactively"></a>
</h4>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"variety"</span><span class="op">)</span></span>
<span><span class="va">colcontent_violate</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">validate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/satisfying.html" class="external-link">violating</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">colcontent_valid</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">var</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">colcontent_violate</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">variety</th>
<th align="left">location</th>
<th align="right">year</th>
<th align="right">rep_temp</th>
<th align="left">sourcefile</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">variety_1</td>
<td align="left">Aberdeen</td>
<td align="right">2020</td>
<td align="right">1</td>
<td align="left">test</td>
</tr>
<tr class="even">
<td align="left">3</td>
<td align="left"></td>
<td align="left">NA</td>
<td align="right">2020</td>
<td align="right">3</td>
<td align="left">test</td>
</tr>
</tbody>
</table>
</div>
</div>
</div>
<div class="section level2">
<h2 id="validate-metadata">Validate metadata<a class="anchor" aria-label="anchor" href="#validate-metadata"></a>
</h2>
<p>The steps in validating the metadata is the same as validating the
trial data, except the argument
<code>codebook_name = "trials_metadata"</code>.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_validate</span> <span class="op">&lt;-</span> <span class="va">test_data</span></span></code></pre></div>
<div class="section level3">
<h3 id="check-variable-names">Check variable names<a class="anchor" aria-label="anchor" href="#check-variable-names"></a>
</h3>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_colname_valid</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu"><a href="../reference/validate_colnames.html">validate_colnames</a></span><span class="op">(</span></span>
<span>    <span class="va">metadata_validate</span>, </span>
<span>    <span class="st">"trials_metadata"</span>,</span>
<span>    db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span></span>
<span>    <span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">comment</span>, <span class="va">colname_data</span>, <span class="va">colname_codebook</span>, <span class="va">required</span>, <span class="va">col_num</span><span class="op">)</span> </span>
<span><span class="co">#&gt; Joining with `by = join_by(comment)`</span></span>
<span><span class="co">#&gt; Status: <span style="color: #949494;"># A tibble: 3 × 4</span> comment n required req <span style="color: #949494; font-style: italic;">&lt;chr&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #BCBCBC;">1</span></span></span>
<span><span class="co">#&gt; exists in both data and codebook 2 <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span> <span style="color: #BCBCBC;">2</span> not present in codebook:</span></span>
<span><span class="co">#&gt; trials_metadata 3 <span style="color: #BB0000;">NA</span> <span style="color: #BB0000;">NA</span> <span style="color: #BCBCBC;">3</span> not present in data 25 TRUE 10</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">metadata_colname_valid</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="45%">
<col width="14%">
<col width="21%">
<col width="10%">
<col width="8%">
</colgroup>
<thead><tr class="header">
<th align="left">comment</th>
<th align="left">colname_data</th>
<th align="left">colname_codebook</th>
<th align="left">required</th>
<th align="right">col_num</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">trial</td>
<td align="left">TRUE</td>
<td align="right">1</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">nursery</td>
<td align="left">TRUE</td>
<td align="right">3</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">latitude</td>
<td align="left">TRUE</td>
<td align="right">8</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">longitude</td>
<td align="left">TRUE</td>
<td align="right">9</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">irrigation</td>
<td align="left">TRUE</td>
<td align="right">10</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">planting_date</td>
<td align="left">TRUE</td>
<td align="right">11</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">harvest_date</td>
<td align="left">TRUE</td>
<td align="right">12</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">plot_length</td>
<td align="left">TRUE</td>
<td align="right">14</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">plot_width</td>
<td align="left">TRUE</td>
<td align="right">15</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">tillage</td>
<td align="left">TRUE</td>
<td align="right">31</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">row_spacing_in</td>
<td align="left">FALSE</td>
<td align="right">16</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">npks_lb_acre</td>
<td align="left">FALSE</td>
<td align="right">17</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">chemical_trts</td>
<td align="left">FALSE</td>
<td align="right">18</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">seed_rate_per_acre</td>
<td align="left">FALSE</td>
<td align="right">19</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">seed_trt</td>
<td align="left">FALSE</td>
<td align="right">20</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">agronomic_notes</td>
<td align="left">FALSE</td>
<td align="right">21</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">soil_type</td>
<td align="left">FALSE</td>
<td align="right">23</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">soil_om</td>
<td align="left">FALSE</td>
<td align="right">24</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">ph</td>
<td align="left">FALSE</td>
<td align="right">25</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">n_lbs_acre</td>
<td align="left">FALSE</td>
<td align="right">26</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">p_ppm</td>
<td align="left">FALSE</td>
<td align="right">27</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">k_ppm</td>
<td align="left">FALSE</td>
<td align="right">28</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">s_ppm</td>
<td align="left">FALSE</td>
<td align="right">29</td>
</tr>
<tr class="even">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">free_lime_pct</td>
<td align="left">FALSE</td>
<td align="right">30</td>
</tr>
<tr class="odd">
<td align="left">not present in data</td>
<td align="left">NA</td>
<td align="left">unpublished</td>
<td align="left">FALSE</td>
<td align="right">33</td>
</tr>
<tr class="even">
<td align="left">not present in codebook: trials_metadata</td>
<td align="left">variety</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">not present in codebook: trials_metadata</td>
<td align="left">rep_temp</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="even">
<td align="left">not present in codebook: trials_metadata</td>
<td align="left">sourcefile</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="right">NA</td>
</tr>
<tr class="odd">
<td align="left">exists in both data and codebook</td>
<td align="left">location</td>
<td align="left">location</td>
<td align="left">TRUE</td>
<td align="right">6</td>
</tr>
<tr class="even">
<td align="left">exists in both data and codebook</td>
<td align="left">year</td>
<td align="left">year</td>
<td align="left">TRUE</td>
<td align="right">4</td>
</tr>
</tbody>
</table>
</div>
<div class="section level3">
<h3 id="check-variable-values">Check variable values<a class="anchor" aria-label="anchor" href="#check-variable-values"></a>
</h3>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">metadata_colcontent_valid</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/confront_data.html">confront_data</a></span><span class="op">(</span><span class="va">metadata_validate</span>, </span>
<span>                                           df_type <span class="op">=</span> <span class="st">"trials_metadata"</span>,</span>
<span>                                           db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span></span>
<span><span class="co">#&gt; Warning: Some issues left to resolve </span></span>
<span><span class="co">#&gt; <span style="color: #949494;"># A tibble: 2 × 5</span></span></span>
<span><span class="co">#&gt;   required fails   nNA error warning</span></span>
<span><span class="co">#&gt;   <span style="color: #949494; font-style: italic;">&lt;lgl&gt;</span>    <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span> <span style="color: #949494; font-style: italic;">&lt;int&gt;</span>   <span style="color: #949494; font-style: italic;">&lt;int&gt;</span></span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">1</span> FALSE        0     0    15       0</span></span>
<span><span class="co">#&gt; <span style="color: #BCBCBC;">2</span> TRUE         1     2    10       0</span></span>
<span></span>
<span><span class="va">metadata_colcontent_summary</span> <span class="op">&lt;-</span> <span class="va">metadata_colcontent_valid</span><span class="op">[[</span><span class="st">"summary"</span><span class="op">]</span><span class="op">]</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">metadata_colcontent_summary</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="11%">
<col width="3%">
<col width="4%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="5%">
<col width="59%">
</colgroup>
<thead><tr class="header">
<th align="left">required</th>
<th align="left">name</th>
<th align="right">items</th>
<th align="right">passes</th>
<th align="right">fails</th>
<th align="right">nNA</th>
<th align="left">error</th>
<th align="left">warning</th>
<th align="left">expression</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">year</td>
<td align="right">4</td>
<td align="right">3</td>
<td align="right">0</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">year - 1995 &gt;= -1e-08 &amp; year - 2024 &lt;= 1e-08
&amp; year%%1 == 0</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">location</td>
<td align="right">4</td>
<td align="right">2</td>
<td align="right">1</td>
<td align="right">1</td>
<td align="left">FALSE</td>
<td align="left">FALSE</td>
<td align="left">location %vin% db[[“locations.csv”]][[“location”]]</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">trial</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">is.character(trial)</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">nursery</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">nursery %vin% db[[“nursery.csv”]][[“nursery”]]</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">latitude</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">latitude - 42 &gt;= -1e-08 &amp; latitude - 49 &lt;=
1e-08</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">longitude</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">longitude - -124.77 &gt;= -1e-08 &amp; longitude -
-111.05 &lt;= 1e-08</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">irrigation</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">irrigation %vin% c(“irrigated”, “dryland”)</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">planting_date</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">grepl(“[0-9]{4}-|/[0-9]{2}-|/[0-9]{2}”,
planting_date)</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">harvest_date</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">grepl(“[0-9]{4}-|/[0-9]{2}-|/[0-9]{2}”,
harvest_date)</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">plot_length</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">plot_length - 5 &gt;= -1e-08 &amp; plot_length - 200
&lt;= 1e-08 | plot_length %vin% c(-9)</td>
</tr>
<tr class="odd">
<td align="left">TRUE</td>
<td align="left">plot_width</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">plot_width - 2 &gt;= -1e-08 &amp; plot_width - 50 &lt;=
1e-08 | plot_width %vin% c(-9)</td>
</tr>
<tr class="even">
<td align="left">TRUE</td>
<td align="left">tillage</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">tillage %vin% c(“conventional”, “no till”,
“conservation”)</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">row_spacing_in</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">row_spacing_in - 1 &gt;= -1e-08 &amp; row_spacing_in -
50 &lt;= 1e-08 | row_spacing_in %vin% c(-9)</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">npks_lb_acre</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">is.character(npks_lb_acre)</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">chemical_trts</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">nchar(as.character(chemical_trts)) &lt;= 20</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">seed_rate_per_acre</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">seed_rate_per_acre %vin% c(7e+05, 1e+06)</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">seed_trt</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">seed_trt %vin% c(TRUE, FALSE)</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">agronomic_notes</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">nchar(as.character(agronomic_notes)) &lt;= 500</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">soil_type</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">nchar(as.character(soil_type)) &lt;= 50</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">soil_om</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">soil_om - 0 &gt;= -1e-08 &amp; soil_om - 100 &lt;=
1e-08</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">ph</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">ph - 0 &gt;= -1e-08 &amp; ph - 14 &lt;= 1e-08</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">n_lbs_acre</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">n_lbs_acre - 0 &gt;= -1e-08 &amp; n_lbs_acre - 500
&lt;= 1e-08</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">p_ppm</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">p_ppm - 0 &gt;= -1e-08 &amp; p_ppm - 200 &lt;=
1e-08</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">k_ppm</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">k_ppm - 0 &gt;= -1e-08 &amp; k_ppm - 1000 &lt;=
1e-08</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">s_ppm</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">s_ppm - 0 &gt;= -1e-08 &amp; s_ppm - 200 &lt;=
1e-08</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">free_lime_pct</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">free_lime_pct - 0 &gt;= -1e-08 &amp; free_lime_pct -
100 &lt;= 1e-08</td>
</tr>
<tr class="odd">
<td align="left">FALSE</td>
<td align="left">unpublished</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="right">0</td>
<td align="left">TRUE</td>
<td align="left">FALSE</td>
<td align="left">unpublished %vin% c(TRUE, FALSE)</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span></span>
<span><span class="co">#Check for any fails interactively:</span></span>
<span></span>
<span><span class="va">metadata_var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"location"</span><span class="op">)</span></span>
<span><span class="va">metadata_colcontent_violate</span> <span class="op">&lt;-</span> </span>
<span>  <span class="fu">validate</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/validate/man/satisfying.html" class="external-link">violating</a></span><span class="op">(</span><span class="va">test_data</span>, <span class="va">metadata_colcontent_valid</span><span class="op">[[</span><span class="fl">2</span><span class="op">]</span><span class="op">]</span><span class="op">[</span><span class="va">metadata_var</span><span class="op">]</span><span class="op">)</span> <span class="op"><a href="https://magrittr.tidyverse.org/reference/pipe.html" class="external-link">%&gt;%</a></span> </span>
<span>  <span class="fu"><a href="https://dplyr.tidyverse.org/reference/relocate.html" class="external-link">relocate</a></span><span class="op">(</span><span class="fu"><a href="https://tidyselect.r-lib.org/reference/starts_with.html" class="external-link">matches</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">metadata_colcontent_violate</span><span class="op">)</span></span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left"></th>
<th align="left">variety</th>
<th align="left">location</th>
<th align="right">year</th>
<th align="right">rep_temp</th>
<th align="left">sourcefile</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">4</td>
<td align="left">NA</td>
<td align="left">location_x</td>
<td align="right">NA</td>
<td align="right">4</td>
<td align="left">test</td>
</tr></tbody>
</table>
</div>
</div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside>
</div>



    <footer><div class="pkgdown-footer-left">
  <p>Developed by Jacqueline Tay.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.1.</p>
</div>

    </footer>
</div>





  </body>
</html>
