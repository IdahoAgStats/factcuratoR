<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Example of the cultivar matching process • factcuratoR</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><link href="../extra.css" rel="stylesheet">
<meta property="og:title" content="Example of the cultivar matching process">
<meta property="og:description" content="factcuratoR">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">factcuratoR</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/example_cultivar_matching.html">Example of the cultivar matching process</a>
    </li>
    <li>
      <a href="../articles/intro_codebooks.html">Introduction to the codebook structure</a>
    </li>
    <li>
      <a href="../articles/intro_validation.html">Introduction to the validation functions</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Example of the cultivar matching process</h1>
                        <h4 data-toc-skip class="author">Jacqueline Tay</h4>
            
            <h4 data-toc-skip class="date">Mar 03, 2022</h4>
      
      
      <div class="hidden name"><code>example_cultivar_matching.Rmd</code></div>

    </div>

    
    
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va">factcuratoR</span><span class="op">)</span>

<span class="va">codebook_folder</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"tests/testthat/test_controlled_vocab"</span><span class="op">)</span>
<span class="va">example_folder</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"inst/extdata/example_cultivar_matching"</span><span class="op">)</span>
<span class="va">knitroutputfolder</span> <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="va">example_folder</span>, <span class="st">"output"</span><span class="op">)</span>
<span class="va">knitroutputfolder_blends</span> <span class="op">=</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="va">example_folder</span>, <span class="st">"output_blends"</span><span class="op">)</span>
<span class="va">auxiliary_files</span> <span class="op">&lt;-</span> <span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="va">example_folder</span>, <span class="st">"auxiliary_files"</span><span class="op">)</span></code></pre></div>
<div class="section level1">
<h1 id="read-in-raw-variety-names">Read in raw variety names<a class="anchor" aria-label="anchor" href="#read-in-raw-variety-names"></a>
</h1>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">var</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="va">example_folder</span>, <span class="st">"example_cultivar_matching.csv"</span><span class="op">)</span>, 
                col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">var</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="24%">
<col width="8%">
<col width="6%">
<col width="60%">
</colgroup>
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">nursery</th>
<th align="left">behavior_to_test</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Wildfile (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">main name is misspelled, so do.exactmatch matches the alias</td>
</tr>
<tr class="even">
<td align="left">wildfir</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">misspelling that won’t exact match</td>
</tr>
<tr class="odd">
<td align="left">AAC wildfire</td>
<td align="left">wheat</td>
<td align="left">H_W</td>
<td align="left">Exact match</td>
</tr>
<tr class="even">
<td align="left">AAC wildfire (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">both names will exact match and the alias will be moved to “not needed”</td>
</tr>
<tr class="odd">
<td align="left">W512</td>
<td align="left">wheat</td>
<td align="left">H_W</td>
<td align="left">exact match with alias</td>
</tr>
<tr class="even">
<td align="left">W512</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">duplicate of W512 with different nursery</td>
</tr>
<tr class="odd">
<td align="left">new name 101 (alias name101)</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">new name with alias</td>
</tr>
<tr class="even">
<td align="left">New 101</td>
<td align="left">wheat</td>
<td align="left">S_W</td>
<td align="left">duplicate to (new name 1) but very different naming</td>
</tr>
<tr class="odd">
<td align="left">new101</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">same internal id as New 1</td>
</tr>
<tr class="even">
<td align="left">new name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">new name</td>
</tr>
<tr class="odd">
<td align="left">Name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">duplicate to (new name 2) but slightly different naming</td>
</tr>
<tr class="even">
<td align="left">WA008123</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">test fuzzymatching with numbers and leading zeros</td>
</tr>
<tr class="odd">
<td align="left">melbclub</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">test that fuzzymatching returns the correct fuzzymatches</td>
</tr>
<tr class="even">
<td align="left">wb1035cl</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">test fuzzymatching with numbers</td>
</tr>
<tr class="odd">
<td align="left">455</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">test fuzzymatching with numbers</td>
</tr>
</tbody>
</table>
</div>
<div class="section level1">
<h1 id="cultivar-matching">Cultivar matching<a class="anchor" aria-label="anchor" href="#cultivar-matching"></a>
</h1>
<div class="section level2">
<h2 id="create-unique-internal-id-for-names">Create unique internal id for names<a class="anchor" aria-label="anchor" href="#create-unique-internal-id-for-names"></a>
</h2>
<p>Extraneous information in the variety name will make the matching process more difficult - the names won’t match by exact matching and it is less certain that the fuzzymatching functions will be able to detect a fuzzymatch.</p>
<p>Some types of information that may be stored in the variety name column that should be removed includes: parental cross, crop type, agronomic treatments (“fill”, “sprayed”, etc).</p>
<p>Remove extraneous information stored in the raw variety column by duplicating the name column and removing the extraneous information (which can usually be accomplished by regex). The column is duplicated because the raw variety name should be retained to match database matches back with the data.</p>
<p>Additionally, if there are blends, they should be separated from the other variety names and matched separately. Many of the variety matching functions have the argument <code>is_blends</code>, which can be set to TRUE to match the blends (See the section below on matching blends). The functions will help standardize the names according to the formatting for blends: name1;name2</p>
<p><span class="important"> Note! </span> Once the fuzzy matching stage is started, it is important that the <code>var_id</code> doesn’t change other it will cause problems with matching up matches with the correct names.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">names_raw</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/create_intid.html">create_intid</a></span><span class="op">(</span><span class="va">var</span>, 
               <span class="va">variety</span>, 
               sep_aliases <span class="op">=</span> <span class="st">"\\("</span>, 
               <span class="va">crop_type</span>, 
               <span class="va">nursery</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html" class="external-link">%&gt;%</a></span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">var_id</span><span class="op">)</span><span class="op">)</span><span class="co">#, </span>
               <span class="co">#alias_col = alias)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">names_raw</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">nursery</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">455</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">455</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">AAC wildfire</td>
<td align="left">wheat</td>
<td align="left">H_W</td>
<td align="left">variety</td>
<td align="left">aacwildfire</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">AAC wildfire (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">aacwildfire</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">AAC wildfire (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">alias</td>
<td align="left">w512</td>
<td align="left">3</td>
</tr>
<tr class="odd">
<td align="left">melbclub</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">melbclub</td>
<td align="left">4</td>
</tr>
<tr class="even">
<td align="left">Name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">name201</td>
<td align="left">5</td>
</tr>
<tr class="odd">
<td align="left">New 101</td>
<td align="left">wheat</td>
<td align="left">S_W</td>
<td align="left">variety</td>
<td align="left">new101</td>
<td align="left">6</td>
</tr>
<tr class="even">
<td align="left">new name 101 (alias name101)</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">newname101</td>
<td align="left">7</td>
</tr>
<tr class="odd">
<td align="left">new name 101 (alias name101)</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">alias</td>
<td align="left">aliasname101</td>
<td align="left">7</td>
</tr>
<tr class="even">
<td align="left">new name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">newname201</td>
<td align="left">8</td>
</tr>
<tr class="odd">
<td align="left">new101</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">new101</td>
<td align="left">9</td>
</tr>
<tr class="even">
<td align="left">W512</td>
<td align="left">wheat</td>
<td align="left">H_W;HRW</td>
<td align="left">variety</td>
<td align="left">w512</td>
<td align="left">10</td>
</tr>
<tr class="odd">
<td align="left">WA008123</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">wa008123</td>
<td align="left">11</td>
</tr>
<tr class="even">
<td align="left">wb1035cl</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">wb1035cl</td>
<td align="left">12</td>
</tr>
<tr class="odd">
<td align="left">Wildfile (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">wildfile</td>
<td align="left">13</td>
</tr>
<tr class="even">
<td align="left">Wildfile (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">alias</td>
<td align="left">w512</td>
<td align="left">13</td>
</tr>
<tr class="odd">
<td align="left">wildfir</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">wildfir</td>
<td align="left">14</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="do-exact-match">Do exact match<a class="anchor" aria-label="anchor" href="#do-exact-match"></a>
</h2>
<p>The first step is to exact match to the cultivar names in the codebooks</p>
<p>The second step is to exact match to the names in the cv_rename.csv. cv_rename.csv contains misspellings.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_exactmatch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/do_exactmatch.html">do_exactmatch</a></span><span class="op">(</span>db_folder <span class="op">=</span> <span class="va">codebook_folder</span>,
                data_intid <span class="op">=</span> <span class="va">names_raw</span>,
                select_before <span class="op">=</span> <span class="st">"2021-11-22"</span>,
                match_type <span class="op">=</span> <span class="st">"raw"</span><span class="op">)</span>
<span class="co">#&gt; match: 5 nomatch: 10 check: 0 not_needed: 2</span>

<span class="va">results_rename</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/do_exactmatch.html">do_exactmatch</a></span><span class="op">(</span>db_folder <span class="op">=</span> <span class="va">codebook_folder</span>, 
                data_intid <span class="op">=</span> <span class="va">results_exactmatch</span><span class="op">$</span><span class="va">nomatch</span>, 
                match_type <span class="op">=</span> <span class="st">"raw"</span>, 
                rename_df <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; var_id and db_id do not exist. test_multmatch and test_aliasdup not run</span>
<span class="co">#&gt; match: 2 nomatch: 8 check: 0 not_needed: 0</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results_exactmatch</span><span class="op">[[</span><span class="st">"match"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="11%">
<col width="5%">
<col width="4%">
<col width="4%">
<col width="6%">
<col width="3%">
<col width="3%">
<col width="13%">
<col width="7%">
<col width="7%">
<col width="4%">
<col width="7%">
<col width="6%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">nursery</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="right">db_id</th>
<th align="left">crop_db</th>
<th align="left">crop_type_db</th>
<th align="left">date_added_db</th>
<th align="left">type_db</th>
<th align="left">variety_db</th>
<th align="left">intid_db</th>
<th align="left">is_truematch</th>
<th align="left">any_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">455</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">455</td>
<td align="left">1</td>
<td align="right">1141</td>
<td align="left">Hard White Spring Wheat</td>
<td align="left">wheat</td>
<td align="left">2021-09-15</td>
<td align="left">variety</td>
<td align="left">455</td>
<td align="left">455</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">AAC wildfire</td>
<td align="left">wheat</td>
<td align="left">H_W</td>
<td align="left">variety</td>
<td align="left">aacwildfire</td>
<td align="left">2</td>
<td align="right">437</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">variety</td>
<td align="left">AAC Wildfire</td>
<td align="left">aacwildfire</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">AAC wildfire (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">aacwildfire</td>
<td align="left">3</td>
<td align="right">437</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">variety</td>
<td align="left">AAC Wildfire</td>
<td align="left">aacwildfire</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">W512</td>
<td align="left">wheat</td>
<td align="left">H_W;HRW</td>
<td align="left">variety</td>
<td align="left">w512</td>
<td align="left">10</td>
<td align="right">437</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">alias</td>
<td align="left">W512</td>
<td align="left">w512</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">Wildfile (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">alias</td>
<td align="left">w512</td>
<td align="left">13</td>
<td align="right">437</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">alias</td>
<td align="left">W512</td>
<td align="left">w512</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results_rename</span><span class="op">[[</span><span class="st">"match"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="6%">
<col width="7%">
<col width="5%">
<col width="5%">
<col width="6%">
<col width="5%">
<col width="8%">
<col width="7%">
<col width="7%">
<col width="9%">
<col width="5%">
<col width="6%">
<col width="9%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">nursery</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="left">intid_db_db</th>
<th align="left">variety_db</th>
<th align="left">wrong_name</th>
<th align="left">crop_type_db</th>
<th align="left">type_db</th>
<th align="left">intid_db</th>
<th align="left">is_truematch</th>
<th align="left">any_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">melbclub</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">melbclub</td>
<td align="left">4</td>
<td align="left">melba</td>
<td align="left">Melba</td>
<td align="left">melbclub</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">melbclub</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">wb1035cl</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">wb1035cl</td>
<td align="left">12</td>
<td align="left">wb1035cl+</td>
<td align="left">WB-1035CL+</td>
<td align="left">WB 1035 CL</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">wb1035cl</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">results_rename</span><span class="op">[[</span><span class="st">"nomatch"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">nursery</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="left">wrong_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">Name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">name201</td>
<td align="left">5</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">New 101</td>
<td align="left">wheat</td>
<td align="left">S_W</td>
<td align="left">variety</td>
<td align="left">new101</td>
<td align="left">6</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">new name 101 (alias name101)</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">newname101</td>
<td align="left">7</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">new name 101 (alias name101)</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">alias</td>
<td align="left">aliasname101</td>
<td align="left">7</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">new name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">newname201</td>
<td align="left">8</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">new101</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">new101</td>
<td align="left">9</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">WA008123</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">wa008123</td>
<td align="left">11</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">wildfir</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">wildfir</td>
<td align="left">14</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="do-fuzzymatch">Do fuzzymatch<a class="anchor" aria-label="anchor" href="#do-fuzzymatch"></a>
</h2>
<p>The fuzzy matching procedure, a wrapper for <code><a href="https://rdrr.io/pkg/fuzzyjoin/man/stringdist_join.html" class="external-link">fuzzyjoin::stringdist_join()</a></code> returns the best fuzzy matches using multiple distance methods (e.g. “lv”, “jw”, “lcs”). See <code>??stringdist</code> for more information about these distance metrics.</p>
<p>The results are filtered for these conditions:</p>
<ul>
<li><p>The variable in <code>crop_type</code> must match (e.g. “wheat” would not match “barley”)</p></li>
<li><p>Numbers located at the end of a variety name or alias must be an exact match if there is more than one number present. If there is only number at the end of a variety name, the trailing digit does not need to match the rest of the name. For example “myvar1” would still match with “myvar”, but “myvar123” would not match “myvar”.</p></li>
</ul>
<p>The results of <code>find_fuzzymatch(</code>) are written to the file <em>fuzzymatch.csv</em> in the directory provided by the user in the <code>knitroutputfolder</code> argument.</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">output_fuzzymatch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/find_fuzzymatch.html">find_fuzzymatch</a></span><span class="op">(</span><span class="va">results_rename</span><span class="op">$</span><span class="va">nomatch</span>,
                intid_col <span class="op">=</span> <span class="st">"intid"</span>,
                select_before <span class="op">=</span> <span class="st">"2021-05-26"</span>,
                knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder</span>,
                db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span>
<span class="co">#&gt; Writing out fuzzymatch.csv</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">output_fuzzymatch</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="4%">
<col width="4%">
<col width="6%">
<col width="11%">
<col width="6%">
<col width="2%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="9%">
<col width="3%">
<col width="4%">
<col width="5%">
<col width="23%">
<col width="3%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">is_truematch</th>
<th align="left">intid</th>
<th align="left">intid_db</th>
<th align="left">variety</th>
<th align="left">variety_db</th>
<th align="left">var_id</th>
<th align="right">db_id</th>
<th align="left">type</th>
<th align="left">type_db</th>
<th align="left">crop_db</th>
<th align="left">crop_type</th>
<th align="left">crop_type_db</th>
<th align="left">date_added_db</th>
<th align="left">method</th>
<th align="left">nursery</th>
<th align="left">wrong_name</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left"></td>
<td align="left">wa008123</td>
<td align="left">wa8123</td>
<td align="left">WA008123</td>
<td align="left">WA8123</td>
<td align="left">11</td>
<td align="right">495</td>
<td align="left">variety</td>
<td align="left">alias</td>
<td align="left">Hard White Spring Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;jw dist_scaled;lv dist;lv dist_scaled;lcs dist_scaled</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">wildfir</td>
<td align="left">aacwildfire</td>
<td align="left">wildfir</td>
<td align="left">AAC Wildfire</td>
<td align="left">14</td>
<td align="right">437</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;jw dist_scaled;lv dist;lv dist_scaled;lcs dist_scaled</td>
<td align="left">HRW</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">new101</td>
<td align="left">lww101018</td>
<td align="left">New 101</td>
<td align="left">LWW10-1018</td>
<td align="left">6</td>
<td align="right">584</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;lcs dist_scaled</td>
<td align="left">S_W</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">new101</td>
<td align="left">lww101073</td>
<td align="left">New 101</td>
<td align="left">LWW10-1073</td>
<td align="left">6</td>
<td align="right">585</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;lcs dist_scaled</td>
<td align="left">S_W</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">new101</td>
<td align="left">xa1101</td>
<td align="left">New 101</td>
<td align="left">XA1101</td>
<td align="left">6</td>
<td align="right">757</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">lv dist;lv dist_scaled</td>
<td align="left">S_W</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">aliasname101</td>
<td align="left">lcsaymeric</td>
<td align="left">new name 101 (alias name101)</td>
<td align="left">LCS Aymeric</td>
<td align="left">7</td>
<td align="right">795</td>
<td align="left">alias</td>
<td align="left">variety</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2021-04-30</td>
<td align="left">lv dist</td>
<td align="left">SWW</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">newname101</td>
<td align="left">beamer</td>
<td align="left">new name 101 (alias name101)</td>
<td align="left">Beamer</td>
<td align="left">7</td>
<td align="right">462</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;lv dist</td>
<td align="left">SWW</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">newname101</td>
<td align="left">xa1101</td>
<td align="left">new name 101 (alias name101)</td>
<td align="left">XA1101</td>
<td align="left">7</td>
<td align="right">757</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;lv dist</td>
<td align="left">SWW</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">newname201</td>
<td align="left">beamer</td>
<td align="left">new name 201</td>
<td align="left">Beamer</td>
<td align="left">8</td>
<td align="right">462</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist</td>
<td align="left">SWW</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">newname201</td>
<td align="left">syclearstone2cl</td>
<td align="left">new name 201</td>
<td align="left">SY Clearstone 2CL</td>
<td align="left">8</td>
<td align="right">660</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist_scaled</td>
<td align="left">SWW</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">new101</td>
<td align="left">lww101018</td>
<td align="left">new101</td>
<td align="left">LWW10-1018</td>
<td align="left">9</td>
<td align="right">584</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">NA</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;lcs dist_scaled</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left"></td>
<td align="left">new101</td>
<td align="left">lww101073</td>
<td align="left">new101</td>
<td align="left">LWW10-1073</td>
<td align="left">9</td>
<td align="right">585</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">NA</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;lcs dist_scaled</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left"></td>
<td align="left">new101</td>
<td align="left">xa1101</td>
<td align="left">new101</td>
<td align="left">XA1101</td>
<td align="left">9</td>
<td align="right">757</td>
<td align="left">variety</td>
<td align="left">variety</td>
<td align="left">Soft White Winter Wheat</td>
<td align="left">NA</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">lv dist;lv dist_scaled</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">FALSE</td>
<td align="left">name201</td>
<td align="left">NA</td>
<td align="left">Name 201</td>
<td align="left">NA</td>
<td align="left">5</td>
<td align="right">NA</td>
<td align="left">variety</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">SWW</td>
<td align="left">NA</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="fill-out-the-fuzzymatch-csv">Fill out the fuzzymatch.csv<a class="anchor" aria-label="anchor" href="#fill-out-the-fuzzymatch-csv"></a>
</h2>
<p>Move <em>fuzzymatch.csv</em> to the helper_files/ directory and fill out the <code>is_truematch</code> column. (You can append the file with the ending "_aux" to clearly differentiate it between the .csv that will be written to the output/ directory for each run of the .Rmd.) Fill the <code>is_truematch</code> column with “TRUE” if fuzzymatch is a true match, otherwise fill with “FALSE”.</p>
<p>Sometimes the match may be clear, however, many matches will need to be manually checked. Some steps for that:</p>
<ol style="list-style-type: decimal">
<li><p>First, start off with a Google search to determine if there are clear usages of both names (name in the raw data and name in the database). This would suggest that the names refer to different varieties and they are not true matches.</p></li>
<li><p>If a Google search doesn’t help clarify whether the name is a true match (quite likely, unfortunately), check the possible matches with our collaborators.</p></li>
<li><p>If there is no clear answer (or any answer), the curator should leave <code>is_truematch</code> blank as the subsequent steps will remind the curator to follow up on these possible matches.</p></li>
</ol>
</div>
<div class="section level2">
<h2 id="process-fuzzymatch_aux-csv-manual-matches">Process <em>fuzzymatch_aux.csv</em> manual matches<a class="anchor" aria-label="anchor" href="#process-fuzzymatch_aux-csv-manual-matches"></a>
</h2>
<ol style="list-style-type: decimal">
<li>Read in the <em>fuzzymatch_aux.csv</em> that has been manually filled in</li>
<li>Process the file using <code><a href="../reference/process_fuzzymatch.html">process_fuzzymatch()</a></code>, which will write out 3 files to the working directory:</li>
</ol>
<ul>
<li>
<em>fuzzy_check.csv</em>, which contains variety names that still need to be manually checked for whether the fuzzy match is a true match. Update is_truematch in the <em>helper_files/fuzzymatch_aux.csv</em> file.</li>
</ul>
<p>There may be newly detected fuzzy matches for successive runs of the .Rmd.<br>
This may occur if there are new names added to the codebook or if the fuzzymatching function is updated.</p>
<p>Newly detected fuzzy matches need to be added to the <em>helper_files/fuzzymatch_aux.csv</em> file. The new matches have only “new_fuzzymatch” in the source column. (“new_fuzzymatch;csv” in the source column means that this was a match for this run of the .Rmd (“new_fuzzymatch”) and that the name is also already present in the original fuzzymatch.csv (“csv”).)</p>
<ul>
<li><p><em>add_fuzzy_to_cv_rename.csv</em>, which contains variety names for which <code>is_truematch</code> is “TRUE.” Manually add the names to <em>cv_rename.csv</em>.</p></li>
<li><p><em>standardize_new_names.csv</em>, which contains variety names that have no match and need to be standardized before being added to the database. See next section for full details.</p></li>
</ul>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">fuzzy_status</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="va">auxiliary_files</span>, <span class="st">"fuzzymatch_status.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">var_id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BBBB;">──</span><span> </span><span style="font-weight: bold;">Column specification</span><span> </span><span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   is_truematch = <span style="color: #BBBB00;">col_logical()</span><span>,</span></span>
<span class="co">#&gt;   intid = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   intid_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   variety = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   variety_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   var_id = <span style="color: #00BB00;">col_double()</span><span>,</span></span>
<span class="co">#&gt;   db_id = <span style="color: #00BB00;">col_double()</span><span>,</span></span>
<span class="co">#&gt;   type = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   type_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   crop_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   crop_type = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   crop_type_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   date_added_db = <span style="color: #0000BB;">col_date(format = "")</span><span>,</span></span>
<span class="co">#&gt;   method = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   nursery = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   wrong_name = <span style="color: #BBBB00;">col_logical()</span></span>
<span class="co">#&gt; )</span>

<span class="va">results_fuzzymatch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/process_fuzzymatch.html">process_fuzzymatch</a></span><span class="op">(</span>output_fuzzymatch_df <span class="op">=</span> <span class="va">output_fuzzymatch</span>, 
                     aux_fuzzy_status <span class="op">=</span> <span class="va">fuzzy_status</span>,
                     knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder</span><span class="op">)</span>
<span class="co">#&gt; Varieties left to check: 0</span>
<span class="co">#&gt; Writing out fuzzy_check.csv.  Check these fuzzymatches.</span>
<span class="co">#&gt;             Add source = new_fuzzymatches to the aux_fuzzy_status file.</span>
<span class="co">#&gt; Writing add_fuzzy_to_cv_rename.csv  Add these names to the main cv_rename.csv</span>
<span class="co">#&gt; Writing standardize_new_names.csv.</span>
<span class="co">#&gt;           If a cultivar has more than one spelling or formatting,</span>
<span class="co">#&gt;           standardize the name in the new_std_name column</span>
<span class="co">#&gt; match: 2 nomatch: 5 check: 0 not_needed: 0</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="standardize-names-without-a-match">Standardize names without a match<a class="anchor" aria-label="anchor" href="#standardize-names-without-a-match"></a>
</h2>
<ol style="list-style-type: decimal">
<li><p>Move <em>standardize_new_names.csv</em> to the helper_files/ directory (You can append the file with the ending "_aux" to clearly differentiate it between the .csv that will be written to the output/ directory for each run of the .Rmd.)</p></li>
<li><p>Go through and standardize the names in <em>standardize_new_names_aux.csv</em> by editing the names in the column <code>new_std_name</code>. The function <code><a href="../reference/process_fuzzymatch.html">process_fuzzymatch()</a></code> will make an initial guess by populating <code>new_std_name</code> with the the raw variety name.</p></li>
</ol>
<p><span class="important">Note on duplicate names: </span> It is especially important if there are different spellings of the same variety, the names are standardized in this file. For example, if “WA0061” and “WA61” are the same variety (spoiler: they are), the <code>new_std_name</code> should be the same for both entries.<br>
If the names are not standardized, processing the names later will create two different entries to add to the database controlled vocabularies.</p>
<p><span class="important">Note on names missed by fuzzy matching: </span> If any of the names in <em>standardize_new_names_aux.csv</em> match a variety in the database, then manually add the names to the <em>controlled_vocab/cv_rename.csv</em> file. This occurs when the name is not found by fuzzy matching. The fuzzy matching functions have been written to return plausible matches while trying to minimize the number of total returns so to not overwhelm the user (you). This trade off means that some potential matches may be missed.</p>
<ol style="list-style-type: decimal">
<li>Read in and process the file using <code><a href="../reference/process_std_new_names.html">process_std_new_names()</a></code>, which will write out files to the /output folder:</li>
</ol>
<ul>
<li>
<em>add_to_new_std_name.csv.</em>, which contains names that have newly passed from the fuzzy matching stage to the name processing stage. If there are entries in this file, add the names to <em>helper_files/standardize_new_names_aux.csv</em> and standardize the <code>std_new_name</code> column as described above.</li>
<li>
<em>add_to_cv_rename.csv</em>, which are names that have been updated in <em>standardize_new_names_aux.csv</em> and won’t match by exact_matching (i.e. if the <code>std_new_name</code> was changed from the default value. If there are entries in this file, add the names to <em>controlled_vocab/cv_rename.csv</em>
</li>
<li>
<em>add_to_db.csv</em>, which contains new varieties. Add these entries to the database. May need to manually fill in extra information such as crop or alias</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">results_new_names</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/process_std_new_names.html">process_std_new_names</a></span><span class="op">(</span>
    output_nomatch_df <span class="op">=</span> <span class="va">results_fuzzymatch</span><span class="op">[[</span><span class="st">"nomatch"</span><span class="op">]</span><span class="op">]</span>, 
    auxiliary_files <span class="op">=</span> <span class="va">auxiliary_files</span>,  
    filename <span class="op">=</span> <span class="st">"standardize_new_names_aux.csv"</span>,
    knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder</span>,
    db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span>
<span class="co">#&gt; Joining, by = c("var_id", "variety", "intid", "type", "crop_type")</span>
<span class="co">#&gt; Writing add_to_cv_rename.csv  Add these names to the main cv_rename.csv</span>
<span class="co">#&gt; Joining, by = "comment"</span>
<span class="co">#&gt; Status: </span>
<span class="co">#&gt; <span style="color: #949494;"># A tibble: 3 x 4</span></span>
<span class="co">#&gt;   comment                               n required   req</span>
<span class="co">#&gt;   <span style="color: #949494;font-style: italic;">&lt;chr&gt;</span><span>                             </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span><span> </span><span style="color: #949494;font-style: italic;">&lt;lgl&gt;</span><span>    </span><span style="color: #949494;font-style: italic;">&lt;int&gt;</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">1</span><span> exists in both data and codebook      1 </span><span style="color: #BB0000;">NA</span><span>          </span><span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">2</span><span> not present in codebook: cultivar    10 </span><span style="color: #BB0000;">NA</span><span>          </span><span style="color: #BB0000;">NA</span></span>
<span class="co">#&gt; <span style="color: #BCBCBC;">3</span><span> not present in data                  10 TRUE         2</span></span>
<span class="co">#&gt; Adding columns: crop, date_added, alias, pedigree, year_released, usage, usda_pi_number, pvp, patent, comments</span>
<span class="co">#&gt; Writing add_to_db.csv.  Add these entries to the database.</span>
<span class="co">#&gt;             May need to manually fill in extra information such as crop or alias</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="iterate-through-the-process">Iterate through the process<a class="anchor" aria-label="anchor" href="#iterate-through-the-process"></a>
</h2>
<p>If the fuzzy_status file is updated (that is, <code>is_truematch</code> is filled in), re-run the entire process in a clean R session and <code><a href="../reference/process_fuzzymatch.html">process_fuzzymatch()</a></code> and <code><a href="../reference/process_std_new_names.html">process_std_new_names()</a></code> will update the output files.</p>
<p>The goal is to iterate through the process outlined above until all of the output files (<em>fuzzy_check.csv</em>, <em>add_to_cv_rename.csv</em>, <em>add_to_new_std_name.csv</em>, and <em>add_to_new_std_name.csv</em>) are empty.</p>
<p>When this has been completed, all of the variety names should be matched and all the necessary information has been moved into the controlled vocabularies.</p>
<p>Hooray! Make sure you celebrate this achievement!</p>
</div>
</div>
<div class="section level1">
<h1 id="collect-all-the-matches-from-each-step">Collect all the matches from each step<a class="anchor" aria-label="anchor" href="#collect-all-the-matches-from-each-step"></a>
</h1>
<p>Once the names from the <code><a href="../reference/process_std_new_names.html">process_std_new_names()</a></code> step have been added to the <em>cv_rename</em> file, then they should match in the cv_rename step.</p>
<p>The function<code><a href="../reference/collect_final_matches.html">collect_final_matches()</a></code> is used to collect all the matches and the stage where they were matched.</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">names_matches</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/collect_final_matches.html">collect_final_matches</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exact <span class="op">=</span> <span class="va">results_exactmatch</span>,
                             rename <span class="op">=</span> <span class="va">results_rename</span>,
                             fuzzy <span class="op">=</span> <span class="va">results_fuzzymatch</span><span class="op">)</span>, 
                        <span class="va">names_raw</span>,
                        knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder</span><span class="op">)</span>
<span class="co">#&gt; Warning: Unknown columns: `intid_db_db`, `wrong_name`, `method`, `source`</span>
<span class="co">#&gt; Warning: Unknown columns: `crop_db`, `method`, `source`</span>
<span class="co">#&gt; Warning: Unknown columns: `intid_db_db`</span>
<span class="co">#&gt; Warning:  5 cultivar(s) not yet matched to the database.</span>
<span class="co">#&gt;                       The raw name is being returned</span>
<span class="co">#&gt; Writing final_matches.csv</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">names_matches</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="18%">
<col width="6%">
<col width="5%">
<col width="5%">
<col width="7%">
<col width="4%">
<col width="5%">
<col width="18%">
<col width="7%">
<col width="8%">
<col width="7%">
<col width="5%">
</colgroup>
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">nursery</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="right">n_var_id</th>
<th align="left">variety_db</th>
<th align="left">match_step</th>
<th align="left">intid_matches</th>
<th align="left">intid_db</th>
<th align="left">type_db</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">455</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">455</td>
<td align="left">1</td>
<td align="right">1</td>
<td align="left">455</td>
<td align="left">exact</td>
<td align="left">455</td>
<td align="left">455</td>
<td align="left">variety</td>
</tr>
<tr class="even">
<td align="left">AAC wildfire</td>
<td align="left">wheat</td>
<td align="left">H_W</td>
<td align="left">variety</td>
<td align="left">aacwildfire</td>
<td align="left">2</td>
<td align="right">1</td>
<td align="left">AAC Wildfire</td>
<td align="left">exact</td>
<td align="left">aacwildfire</td>
<td align="left">aacwildfire</td>
<td align="left">variety</td>
</tr>
<tr class="odd">
<td align="left">AAC wildfire (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">aacwildfire</td>
<td align="left">3</td>
<td align="right">2</td>
<td align="left">AAC Wildfire</td>
<td align="left">exact</td>
<td align="left">aacwildfire</td>
<td align="left">aacwildfire</td>
<td align="left">variety</td>
</tr>
<tr class="even">
<td align="left">melbclub</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">melbclub</td>
<td align="left">4</td>
<td align="right">1</td>
<td align="left">Melba</td>
<td align="left">rename</td>
<td align="left">melbclub</td>
<td align="left">melbclub</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">name201</td>
<td align="left">5</td>
<td align="right">1</td>
<td align="left">Name 201</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">New 101</td>
<td align="left">wheat</td>
<td align="left">S_W</td>
<td align="left">variety</td>
<td align="left">new101</td>
<td align="left">6</td>
<td align="right">1</td>
<td align="left">New 101</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">new name 101 (alias name101)</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">newname101</td>
<td align="left">7</td>
<td align="right">2</td>
<td align="left">new name 101 (alias name101)</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">new name 201</td>
<td align="left">wheat</td>
<td align="left">SWW</td>
<td align="left">variety</td>
<td align="left">newname201</td>
<td align="left">8</td>
<td align="right">1</td>
<td align="left">new name 201</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">new101</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">new101</td>
<td align="left">9</td>
<td align="right">1</td>
<td align="left">new101</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">NA</td>
</tr>
<tr class="even">
<td align="left">W512</td>
<td align="left">wheat</td>
<td align="left">H_W;HRW</td>
<td align="left">variety</td>
<td align="left">w512</td>
<td align="left">10</td>
<td align="right">1</td>
<td align="left">W512</td>
<td align="left">exact</td>
<td align="left">w512</td>
<td align="left">w512</td>
<td align="left">alias</td>
</tr>
<tr class="odd">
<td align="left">WA008123</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">wa008123</td>
<td align="left">11</td>
<td align="right">1</td>
<td align="left">WA8123</td>
<td align="left">fuzzy</td>
<td align="left">wa008123</td>
<td align="left">wa8123</td>
<td align="left">alias</td>
</tr>
<tr class="even">
<td align="left">wb1035cl</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">variety</td>
<td align="left">wb1035cl</td>
<td align="left">12</td>
<td align="right">1</td>
<td align="left">WB-1035CL+</td>
<td align="left">rename</td>
<td align="left">wb1035cl</td>
<td align="left">wb1035cl</td>
<td align="left">NA</td>
</tr>
<tr class="odd">
<td align="left">Wildfile (W512)</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">wildfile</td>
<td align="left">13</td>
<td align="right">2</td>
<td align="left">W512</td>
<td align="left">exact</td>
<td align="left">w512</td>
<td align="left">w512</td>
<td align="left">alias</td>
</tr>
<tr class="even">
<td align="left">wildfir</td>
<td align="left">wheat</td>
<td align="left">HRW</td>
<td align="left">variety</td>
<td align="left">wildfir</td>
<td align="left">14</td>
<td align="right">1</td>
<td align="left">AAC Wildfire</td>
<td align="left">fuzzy</td>
<td align="left">wildfir</td>
<td align="left">aacwildfire</td>
<td align="left">variety</td>
</tr>
</tbody>
</table>
</div>
<div class="section level1">
<h1 id="bind-matches-with-the-data">Bind matches with the data<a class="anchor" aria-label="anchor" href="#bind-matches-with-the-data"></a>
</h1>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># do not run this code (it's here for example only)</span>
<span class="va">data_cv_names</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate-joins.html" class="external-link">left_join</a></span><span class="op">(</span><span class="va">data</span>, <span class="va">names_matches</span>, by <span class="op">=</span> <span class="st">"variety"</span><span class="op">)</span></code></pre></div>
</div>
<div class="section level1">
<h1 id="special-instructions-for-matching-blends">Special instructions for matching blends<a class="anchor" aria-label="anchor" href="#special-instructions-for-matching-blends"></a>
</h1>
<p>Curate the blends separately from non-blend variety names. Below is an example for curating blends.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="st">"tests/testthat/test_match_variety_files"</span>, 
                              <span class="st">"example_blends.csv"</span><span class="op">)</span>, 
                col_types <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/pkg/readr/man/cols.html" class="external-link">cols</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">behavior_to_Test</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">wildfire won’t exact match</td>
</tr>
<tr class="even">
<td align="left">APcoachman/ alpowa</td>
<td align="left">wheat</td>
<td align="left">both should exact match</td>
</tr>
<tr class="odd">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">both won’t exact match</td>
</tr>
</tbody>
</table>
<div class="section level2">
<h2 id="create-unique-internal-id-for-names-1">Create unique internal id for names<a class="anchor" aria-label="anchor" href="#create-unique-internal-id-for-names-1"></a>
</h2>
<p><span class="important"> Note! </span> For blends, set the argument <code>is_blends = TRUE</code> for each of the variety matching functions.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends_raw</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/create_intid.html">create_intid</a></span><span class="op">(</span><span class="va">blends</span>, 
               <span class="va">variety</span>, 
               <span class="co"># Although sep_alias is used to separate </span>
               <span class="co"># an alias from the variety name, it can also be used here </span>
               <span class="co">#to separate two names in a blend</span>
               sep_aliases <span class="op">=</span> <span class="st">"\\/"</span>, 
               <span class="va">crop_type</span>,
               is_blends <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> 

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_raw</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">APcoachman/ alpowa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">apcoachman</td>
<td align="left">1</td>
</tr>
<tr class="even">
<td align="left">APcoachman/ alpowa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">alpowa</td>
<td align="left">1</td>
</tr>
<tr class="odd">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">coachman</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">alpwa</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">wildfire</td>
<td align="left">3</td>
</tr>
<tr class="even">
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">altigo</td>
<td align="left">3</td>
</tr>
</tbody>
</table>
</div>
<div class="section level2">
<h2 id="do-exact-matching-step">Do exact matching step<a class="anchor" aria-label="anchor" href="#do-exact-matching-step"></a>
</h2>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends_exactmatch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/do_exactmatch.html">do_exactmatch</a></span><span class="op">(</span>db_folder <span class="op">=</span> <span class="va">codebook_folder</span>,
                data_intid <span class="op">=</span> <span class="va">blends_raw</span>,
                select_before <span class="op">=</span> <span class="st">"2021-11-22"</span>,
                match_type <span class="op">=</span> <span class="st">"raw"</span>,
                is_blends <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; match: 3 nomatch: 3 check: 0 not_needed: 0</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_exactmatch</span><span class="op">[[</span><span class="st">"match"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table style="width:100%;" class="table">
<colgroup>
<col width="11%">
<col width="6%">
<col width="4%">
<col width="6%">
<col width="4%">
<col width="3%">
<col width="14%">
<col width="7%">
<col width="8%">
<col width="4%">
<col width="7%">
<col width="6%">
<col width="7%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="right">db_id</th>
<th align="left">crop_db</th>
<th align="left">crop_type_db</th>
<th align="left">date_added_db</th>
<th align="left">type_db</th>
<th align="left">variety_db</th>
<th align="left">intid_db</th>
<th align="left">is_truematch</th>
<th align="left">any_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">APcoachman/ alpowa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">apcoachman</td>
<td align="left">1</td>
<td align="right">451</td>
<td align="left">Soft White Spring Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">variety</td>
<td align="left">AP Coachman</td>
<td align="left">apcoachman</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">APcoachman/ alpowa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">alpowa</td>
<td align="left">1</td>
<td align="right">442</td>
<td align="left">Soft White Spring Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">variety</td>
<td align="left">Alpowa</td>
<td align="left">alpowa</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="odd">
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">altigo</td>
<td align="left">3</td>
<td align="right">443</td>
<td align="left">Hard Red Winter Wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">variety</td>
<td align="left">Altigo</td>
<td align="left">altigo</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_exactmatch</span><span class="op">[[</span><span class="st">"nomatch"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">coachman</td>
<td align="left">2</td>
</tr>
<tr class="even">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">alpwa</td>
<td align="left">2</td>
</tr>
<tr class="odd">
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">wildfire</td>
<td align="left">3</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends_rename</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/do_exactmatch.html">do_exactmatch</a></span><span class="op">(</span>db_folder <span class="op">=</span> <span class="va">codebook_folder</span>, 
                data_intid <span class="op">=</span> <span class="va">blends_exactmatch</span><span class="op">$</span><span class="va">nomatch</span>, 
                match_type <span class="op">=</span> <span class="st">"raw"</span>, 
                rename_df <span class="op">=</span> <span class="cn">TRUE</span>, 
                is_blends <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; match: 2 nomatch: 1 check: 0 not_needed: 0</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_rename</span><span class="op">[[</span><span class="st">"match"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="12%">
<col width="7%">
<col width="5%">
<col width="6%">
<col width="5%">
<col width="8%">
<col width="9%">
<col width="7%">
<col width="9%">
<col width="5%">
<col width="6%">
<col width="9%">
<col width="7%">
</colgroup>
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="left">intid_db_db</th>
<th align="left">variety_db</th>
<th align="left">wrong_name</th>
<th align="left">crop_type_db</th>
<th align="left">type_db</th>
<th align="left">intid_db</th>
<th align="left">is_truematch</th>
<th align="left">any_match</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">alpwa</td>
<td align="left">2</td>
<td align="left">alpowa</td>
<td align="left">Alpowa</td>
<td align="left">alpwa</td>
<td align="left">wheat</td>
<td align="left">NA</td>
<td align="left">alpwa</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
<tr class="even">
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">wildfire</td>
<td align="left">3</td>
<td align="left">aacwildfire</td>
<td align="left">AAC Wildfire</td>
<td align="left">Wildfire</td>
<td align="left">NA</td>
<td align="left">NA</td>
<td align="left">wildfire</td>
<td align="left">TRUE</td>
<td align="left">TRUE</td>
</tr>
</tbody>
</table>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_rename</span><span class="op">[[</span><span class="st">"nomatch"</span><span class="op">]</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<table class="table">
<thead><tr class="header">
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">var_id</th>
<th align="left">wrong_name</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">coachman</td>
<td align="left">2</td>
<td align="left">NA</td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="do-fuzzymatching-step">Do fuzzymatching step<a class="anchor" aria-label="anchor" href="#do-fuzzymatching-step"></a>
</h2>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends_fuzzymatch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/find_fuzzymatch.html">find_fuzzymatch</a></span><span class="op">(</span><span class="va">blends_rename</span><span class="op">$</span><span class="va">nomatch</span>,
                intid_col <span class="op">=</span> <span class="st">"intid"</span>,
                select_before <span class="op">=</span> <span class="st">"2021-05-26"</span>,
                knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder_blends</span>,
                db_folder <span class="op">=</span> <span class="va">codebook_folder</span><span class="op">)</span>
<span class="co">#&gt; Writing out fuzzymatch.csv</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_fuzzymatch</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="4%">
<col width="4%">
<col width="6%">
<col width="5%">
<col width="3%">
<col width="2%">
<col width="3%">
<col width="3%">
<col width="10%">
<col width="4%">
<col width="5%">
<col width="6%">
<col width="27%">
<col width="4%">
</colgroup>
<thead><tr class="header">
<th align="left">is_truematch</th>
<th align="left">intid</th>
<th align="left">intid_db</th>
<th align="left">variety</th>
<th align="left">variety_db</th>
<th align="left">var_id</th>
<th align="right">db_id</th>
<th align="left">type</th>
<th align="left">type_db</th>
<th align="left">crop_db</th>
<th align="left">crop_type</th>
<th align="left">crop_type_db</th>
<th align="left">date_added_db</th>
<th align="left">method</th>
<th align="left">wrong_name</th>
</tr></thead>
<tbody><tr class="odd">
<td align="left"></td>
<td align="left">coachman</td>
<td align="left">apcoachman</td>
<td align="left">coachman/alpwa</td>
<td align="left">AP Coachman</td>
<td align="left">2</td>
<td align="right">451</td>
<td align="left">blends</td>
<td align="left">variety</td>
<td align="left">Soft White Spring Wheat</td>
<td align="left">wheat</td>
<td align="left">wheat</td>
<td align="left">2020-06-08</td>
<td align="left">jw dist;jw dist_scaled;lv dist;lv dist_scaled;lcs dist_scaled</td>
<td align="left">NA</td>
</tr></tbody>
</table>
</div>
<div class="section level2">
<h2 id="read-in-and-process-fuzzymatches">Read in and process fuzzymatches<a class="anchor" aria-label="anchor" href="#read-in-and-process-fuzzymatches"></a>
</h2>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends_fuzzy_status</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="https://rdrr.io/pkg/readr/man/read_delim.html" class="external-link">read_csv</a></span><span class="op">(</span><span class="fu">here</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/here/man/here.html" class="external-link">here</a></span><span class="op">(</span><span class="va">auxiliary_files</span>, <span class="st">"fuzzymatch_blends_status.csv"</span><span class="op">)</span><span class="op">)</span> <span class="op"><a href="https://rdrr.io/pkg/magrittr/man/pipe.html" class="external-link">%&gt;%</a></span>
  <span class="fu"><a href="https://rdrr.io/pkg/dplyr/man/mutate.html" class="external-link">mutate</a></span><span class="op">(</span>var_id <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/character.html" class="external-link">as.character</a></span><span class="op">(</span><span class="va">var_id</span><span class="op">)</span><span class="op">)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; <span style="color: #00BBBB;">──</span><span> </span><span style="font-weight: bold;">Column specification</span><span> </span><span style="color: #00BBBB;">────────────────────────────────────────────────────────</span></span>
<span class="co">#&gt; cols(</span>
<span class="co">#&gt;   is_truematch = <span style="color: #BBBB00;">col_logical()</span><span>,</span></span>
<span class="co">#&gt;   intid = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   intid_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   variety = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   variety_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   var_id = <span style="color: #00BB00;">col_double()</span><span>,</span></span>
<span class="co">#&gt;   db_id = <span style="color: #00BB00;">col_double()</span><span>,</span></span>
<span class="co">#&gt;   type = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   type_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   crop_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   crop_type = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   crop_type_db = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   date_added_db = <span style="color: #0000BB;">col_date(format = "")</span><span>,</span></span>
<span class="co">#&gt;   method = <span style="color: #BB0000;">col_character()</span><span>,</span></span>
<span class="co">#&gt;   wrong_name = <span style="color: #BBBB00;">col_logical()</span></span>
<span class="co">#&gt; )</span>

<span class="va">blends_results_fuzzymatch</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/process_fuzzymatch.html">process_fuzzymatch</a></span><span class="op">(</span>output_fuzzymatch_df <span class="op">=</span> <span class="va">blends_fuzzymatch</span>, 
                     aux_fuzzy_status <span class="op">=</span> <span class="va">blends_fuzzy_status</span>,
                     knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder_blends</span><span class="op">)</span>
<span class="co">#&gt; Varieties left to check: 1</span>
<span class="co">#&gt; Writing out fuzzy_check.csv.  Check these fuzzymatches.</span>
<span class="co">#&gt;             Add source = new_fuzzymatches to the aux_fuzzy_status file.</span>
<span class="co">#&gt; Writing add_fuzzy_to_cv_rename.csv  Add these names to the main cv_rename.csv</span>
<span class="co">#&gt; Writing standardize_new_names.csv.</span>
<span class="co">#&gt;           If a cultivar has more than one spelling or formatting,</span>
<span class="co">#&gt;           standardize the name in the new_std_name column</span>
<span class="co">#&gt; match: 0 nomatch: 0 check: 1 not_needed: 0</span></code></pre></div>
</div>
<div class="section level2">
<h2 id="collect-all-matches">Collect all matches<a class="anchor" aria-label="anchor" href="#collect-all-matches"></a>
</h2>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">blends_matches</span> <span class="op">&lt;-</span> 
  <span class="fu"><a href="../reference/collect_final_matches.html">collect_final_matches</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>exact <span class="op">=</span> <span class="va">blends_exactmatch</span>,
                             rename <span class="op">=</span> <span class="va">blends_rename</span>,
                             fuzzy <span class="op">=</span> <span class="va">blends_results_fuzzymatch</span><span class="op">)</span>, 
                        <span class="va">blends_raw</span>,
                        knitroutputfolder <span class="op">=</span> <span class="va">knitroutputfolder_blends</span>,
                        is_blends <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>
<span class="co">#&gt; Warning: Unknown columns: `intid_db_db`, `wrong_name`, `method`, `source`</span>
<span class="co">#&gt; Warning: Unknown columns: `crop_db`, `method`, `source`</span>
<span class="co">#&gt; Warning: Unknown columns: `intid_db_db`</span>
<span class="co">#&gt; Warning:  1 cultivar(s) not yet matched to the database.</span>
<span class="co">#&gt;                       The raw name is being returned</span>
<span class="co">#&gt; Writing final_matches.csv</span>

<span class="fu">knitr</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/knitr/man/kable.html" class="external-link">kable</a></span><span class="op">(</span><span class="va">blends_matches</span><span class="op">)</span></code></pre></div>
<table class="table">
<colgroup>
<col width="5%">
<col width="14%">
<col width="7%">
<col width="5%">
<col width="13%">
<col width="6%">
<col width="15%">
<col width="10%">
<col width="13%">
<col width="6%">
</colgroup>
<thead><tr class="header">
<th align="left">var_id</th>
<th align="left">variety</th>
<th align="left">crop_type</th>
<th align="left">type</th>
<th align="left">intid</th>
<th align="left">n_var_id</th>
<th align="left">variety_db</th>
<th align="left">match_step</th>
<th align="left">intid_db</th>
<th align="left">type_db</th>
</tr></thead>
<tbody>
<tr class="odd">
<td align="left">1</td>
<td align="left">APcoachman/ alpowa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">apcoachman;alpowa</td>
<td align="left">2</td>
<td align="left">AP Coachman;Alpowa</td>
<td align="left">exact</td>
<td align="left">apcoachman;alpowa</td>
<td align="left">variety</td>
</tr>
<tr class="even">
<td align="left">2</td>
<td align="left">coachman/alpwa</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">coachman;alpwa</td>
<td align="left">2</td>
<td align="left">coachman;Alpowa</td>
<td align="left">rename</td>
<td align="left">alpwa</td>
<td align="left"></td>
</tr>
<tr class="odd">
<td align="left">3</td>
<td align="left">wildfire/ altigo</td>
<td align="left">wheat</td>
<td align="left">blends</td>
<td align="left">wildfire;altigo</td>
<td align="left">2</td>
<td align="left">AAC Wildfire;Altigo</td>
<td align="left">rename;exact</td>
<td align="left">wildfire;altigo</td>
<td align="left">variety</td>
</tr>
</tbody>
</table>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by Jacqueline Tay.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.1.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
